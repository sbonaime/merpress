(()=>{"use strict";const e=window.wp.element,t=window.wp.i18n,r=window.wp.blocks,n=window.wp.blockEditor,i=(0,e.createContext)({content:void 0,setContent:()=>{},img:{},setImg:()=>{}});function a(r){const[n,a]=(0,e.useState)(!1),s=(0,e.useRef)(null),{content:c,setImg:o}=(0,e.useContext)(i);return(0,e.useEffect)((()=>{try{window.mermaid.parse(c),a(!1)}catch(e){a(!0)}s.current.removeAttribute("data-processed"),s.current.innerHTML=c,window.mermaid.init(void 0,s.current),s.current.innerHTML,function(e){const t=s.current.querySelector("svg"),r=(new XMLSerializer).serializeToString(t),{width:n,height:i}=(btoa(unescape(encodeURIComponent(r))),t.getBoundingClientRect());var a=document.createElement("canvas"),c=a.getContext("2d");a.width=5*n,a.height=5*i,c.clearRect(0,0,a.width,a.height),async function(){var e=new Image;return new Promise(((t,n)=>{e.onload=()=>{c.drawImage(e,0,0);const r=a.toDataURL("image/jpeg");console.log("img",r),t(r)},e.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(r))),console.log("img as svg",e.src)}))}().then((e=>{o({src:e,width:n,height:i})}))}()}),[c]),(0,e.createElement)(e.Fragment,null,n&&(0,e.createElement)("div",{className:"error"},(0,t.__)("Syntax Error","merpress")),(0,e.createElement)("div",{ref:s,className:'mermaid ${error ? "mermaid-error" : "" }'}))}const s=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"merpress/mermaidjs","title":"MerPress","category":"formatting","icon":"chart-pie","description":"Create diagrams and flow charts using text via Mermaid","keywords":["mermaid","chart","diagram","flow","graph"],"version":"1.0.10-alpha","textdomain":"my-plugin","attributes":{"content":{"type":"string","source":"text","selector":"pre.mermaid"},"img":{"type":"object","source":"query","selector":"div.mermaid-img > img","default":{},"query":{"src":{"type":"string","source":"attribute","attribute":"src"},"width":{"type":"number","source":"attribute","attribute":"width"},"height":{"type":"number","source":"attribute","attribute":"height"}}}},"supports":{"className":false,"html":false},"example":{"attributes":{"content":"graph TD\\nA--\x3eB\\n","png":""}},"editorScript":["file:./index.js"],"editorStyle":["wp-edit-blocks"],"script":["mermaid"],"style":["mermaid-gutenberg-block"],"viewScript":["mermaid-init"]}'),c=window.React;function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}(0,r.registerBlockType)(s,{description:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,t.__)("Create diagrams and flow charts using text via Mermaid","merpress"),"."),(0,e.createElement)("a",{href:"https://mermaid.js.org/community/n00b-overview.html"},(0,t.__)("Documentation","merpress"))),edit:function(t){const{content:r="",img:s=""}=t.attributes,c=(0,n.useBlockProps)(),o=(0,e.useCallback)((e=>{t.setAttributes({content:e})}),[r]),m={content:r,img:s,setContent:o,setImg:(0,e.useCallback)((e=>{t.setAttributes({img:e})}),[s])};return(0,e.createElement)(i.Provider,{value:m},(0,e.createElement)("div",c,t.isSelected&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("pre",{className:"mermaid-editor wp-block-code"},(0,e.createElement)(n.PlainText,{onChange:o,value:r})),(0,e.createElement)("hr",null)),(0,e.createElement)(a,null)))},icon:function(e){return c.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:2},viewBox:"0 0 600 600"},e),c.createElement("path",{d:"M0 0h600v600H0z",style:{fill:"#fff"}}),c.createElement("path",{d:"M282 480 142 177v241c0 22 3 36 8 41 6 8 17 12 31 12h13v9H68v-9h13c15 0 26-5 32-14 4-6 6-19 6-39V182c0-16-2-27-5-35-3-5-7-9-14-12-7-4-17-6-32-6v-9h102l131 282 129-282h102v9h-12c-16 0-27 5-33 14-4 6-6 19-6 39v236c0 22 2 36 7 41 7 8 17 12 32 12h12v9H379v-9h13c15 0 26-5 32-14 4-6 6-19 6-39V177L291 480h-9Z",style:{fillRule:"nonzero"}}))},save:function(t){const{content:r,img:i}=t.attributes,a=n.useBlockProps.save({className:"mermaid"});return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("pre",a,r),i.src&&(0,e.createElement)("div",{className:"mermaid-img"},(0,e.createElement)("img",{src:i.src,width:i.width,height:i.height})))}})})();